{
	"name": "CVE-2024-53044",
	"description": "In the Linux kernel, the following vulnerability has been resolved:net/sched: sch_api: fix xa_insert() error path in tcf_block_get_ext()This command:$ tc qdisc replace dev eth0 ingress_block 1 egress_block 1 clsactError: block dev insert failed: -EBUSY.fails because user space requests the same block index to be set forboth ingress and egress.[ side note, I don't think it even failed prior to commit 913b47d3424e  (\"net/sched: Introduce tc block netdev tracking infra\"), because this  is a command from an old set of notes of mine which used to work, but  alas, I did not scientifically bisect this ]The problem is not that it fails, but rather, that the second timearound, it fails differently (and irrecoverably):$ tc qdisc replace dev eth0 ingress_block 1 egress_block 1 clsactError: dsa_core: Flow block cb is busy.[ another note: the extack is added by me for illustration purposes.  the context of the problem is that clsact_init() obtains the same  \u0026q-\u003eingress_block pointer as \u0026q-\u003eegress_block, and since we call  tcf_block_get_ext() on both of them, \"dev\" will be added to the  block-\u003eports xarray twice, thus failing the operation: once through  the ingress block pointer, and once again through the egress block  pointer. the problem itself is that when xa_insert() fails, we have  emitted a FLOW_BLOCK_BIND command through ndo_setup_tc(), but the  offload never sees a corresponding FLOW_BLOCK_UNBIND. ]Even correcting the bad user input, we still cannot recover:$ tc qdisc replace dev swp3 ingress_block 1 egress_block 2 clsactError: dsa_core: Flow block cb is busy.Basically the only way to recover is to reboot the system, or unbind andrebind the net device driver.To fix the bug, we need to fill the correct error teardown path whichwas missed during code movement, and call tcf_block_offload_unbind()when xa_insert() fails.[ last note, fundamentally I blame the label naming convention in  tcf_block_get_ext() for the bug. The labels should be named after what  they do, not after the error path that jumps to them. This way, it is  obviously wrong that two labels pointing to the same code mean  something is wrong, and checking the code correctness at the goto site  is also easier ]",
	"type": "none",
	"severity": "none",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/8966eb69a143b1c032365fe84f2815f3c46f2590",
		"https://git.kernel.org/stable/c/a13e690191eafc154b3f60afe9ce35aa9b9128b4"
	],
	"datetime": "2025-02-06 12:35:24",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "\u003c 6.1.123-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "\u003c 5.10.223-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux",
			"version": "\u003c 6.11.7-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		}
	],
	"products": [
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.11.7",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc1",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc2",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc3",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc4",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc5",
			"type": "system"
		}
	],
	"programs": [],
	"weaknesses": [
		{
			"name": "any",
			"impact": "any",
			"scope": "any"
		}
	]
}