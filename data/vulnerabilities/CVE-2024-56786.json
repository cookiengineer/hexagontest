{
	"name": "CVE-2024-56786",
	"description": "In the Linux kernel, the following vulnerability has been resolved:bpf: put bpf_link's program when link is safe to be deallocatedIn general, BPF link's underlying BPF program should be considered to bereachable through attach hook -\u003e link -\u003e prog chain, and, pessimistically,we have to assume that as long as link's memory is not safe to free,attach hook's code might hold a pointer to BPF program and use it.As such, it's not (generally) correct to put link's program early beforewaiting for RCU GPs to go through. More eager bpf_prog_put() that wecurrently do is mostly correct due to BPF program's release code doingsimilar RCU GP waiting, but as will be shown in the following patches,BPF program can be non-sleepable (and, thus, reliant on only \"classic\"RCU GP), while BPF link's attach hook can have sleepable semantics andneeds to be protected by RCU Tasks Trace, and for such cases BPF linkhas to go through RCU Tasks Trace + \"classic\" RCU GPs before beingdeallocated. And so, if we put BPF program early, we might free BPFprogram before we free BPF link, leading to use-after-free situation.So, this patch defers bpf_prog_put() until we are ready to performbpf_link's deallocation. At worst, this delays BPF program freeing byone extra RCU GP, but that seems completely acceptable. Alternatively,we'd need more elaborate ways to determine BPF hook, BPF link, and BPFprogram lifetimes, and how they relate to each other, which seems likean unnecessary complication.Note, for most BPF links we still will perform eager bpf_prog_put() andlink dealloc, so for those BPF links there are no observable changeswhatsoever. Only BPF links that use deferred dealloc might noticeslightly delayed freeing of BPF programs.Also, to reduce code and logic duplication, extract program put + linkdealloc logic into bpf_link_dealloc() helper.",
	"type": "none",
	"severity": "none",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/2fcb921c2799c49ac5e365cf4110f94a64ae4885",
		"https://git.kernel.org/stable/c/5fe23c57abadfd46a7a66e81f3536e4757252a0b",
		"https://git.kernel.org/stable/c/f44ec8733a8469143fde1984b5e6931b2e2f6f3f"
	],
	"datetime": "2025-02-06 12:35:27",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "any",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "\u003c 6.12.5-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		}
	],
	"products": [
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.6.66",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.12.5",
			"type": "system"
		}
	],
	"programs": [],
	"weaknesses": [
		{
			"name": "any",
			"impact": "any",
			"scope": "any"
		}
	]
}