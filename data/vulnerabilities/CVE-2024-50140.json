{
	"name": "CVE-2024-50140",
	"description": "In the Linux kernel, the following vulnerability has been resolved:sched/core: Disable page allocation in task_tick_mm_cid()With KASAN and PREEMPT_RT enabled, calling task_work_add() intask_tick_mm_cid() may cause the following splat.[   63.696416] BUG: sleeping function called from invalid context at kernel/locking/spinlock_rt.c:48[   63.696416] in_atomic(): 1, irqs_disabled(): 1, non_block: 0, pid: 610, name: modprobe[   63.696416] preempt_count: 10001, expected: 0[   63.696416] RCU nest depth: 1, expected: 1This problem is caused by the following call trace.  sched_tick() [ acquire rq-\u003e__lock ]   -\u003e task_tick_mm_cid()    -\u003e task_work_add()     -\u003e __kasan_record_aux_stack()      -\u003e kasan_save_stack()       -\u003e stack_depot_save_flags()        -\u003e alloc_pages_mpol_noprof()         -\u003e __alloc_pages_noprof()      -\u003e get_page_from_freelist()       -\u003e rmqueue()        -\u003e rmqueue_pcplist()         -\u003e __rmqueue_pcplist()          -\u003e rmqueue_bulk()           -\u003e rt_spin_lock()The rq lock is a raw_spinlock_t. We can't sleep while holdingit. IOW, we can't call alloc_pages() in stack_depot_save_flags().The task_tick_mm_cid() function with its task_work_add() call wasintroduced by commit 223baf9d17f2 (\"sched: Fix performance regressionintroduced by mm_cid\") in v6.4 kernel.Fortunately, there is a kasan_record_aux_stack_noalloc() variant thatcalls stack_depot_save_flags() while not allowing it to allocatenew pages.  To allow task_tick_mm_cid() to use task_work withoutpage allocation, a new TWAF_NO_ALLOC flag is added to enable callingkasan_record_aux_stack_noalloc() instead of kasan_record_aux_stack()if set. The task_tick_mm_cid() function is modified to add this new flag.The possible downside is the missing stack trace in a KASAN report dueto new page allocation required when task_work_add_noallloc() is calledwhich should be rare.",
	"type": "none",
	"severity": "none",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/509c29d0d26f68a6f6d0a05cb1a89725237e2b87",
		"https://git.kernel.org/stable/c/73ab05aa46b02d96509cb029a8d04fca7bbde8c7",
		"https://git.kernel.org/stable/c/ce0241ef83eed55f675376e8a3605d23de53d875"
	],
	"datetime": "2025-02-06 12:35:22",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "\u003c 6.1.123-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "\u003c 5.10.223-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux",
			"version": "\u003c 6.11.6-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		}
	],
	"products": [
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.6.59",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.11.6",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc1",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc2",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc3",
			"type": "system"
		}
	],
	"programs": [],
	"weaknesses": [
		{
			"name": "any",
			"impact": "any",
			"scope": "any"
		}
	]
}