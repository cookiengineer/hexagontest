{
	"name": "CVE-2024-50194",
	"description": "In the Linux kernel, the following vulnerability has been resolved:arm64: probes: Fix uprobes for big-endian kernelsThe arm64 uprobes code is broken for big-endian kernels as it doesn'tconvert the in-memory instruction encoding (which is alwayslittle-endian) into the kernel's native endianness before analyzing andsimulating instructions. This may result in a few distinct problems:* The kernel may may erroneously reject probing an instruction which can  safely be probed.* The kernel may erroneously erroneously permit stepping an  instruction out-of-line when that instruction cannot be stepped  out-of-line safely.* The kernel may erroneously simulate instruction incorrectly dur to  interpretting the byte-swapped encoding.The endianness mismatch isn't caught by the compiler or sparse because:* The arch_uprobe::{insn,ixol} fields are encoded as arrays of u8, so  the compiler and sparse have no idea these contain a little-endian  32-bit value. The core uprobes code populates these with a memcpy()  which similarly does not handle endianness.* While the uprobe_opcode_t type is an alias for __le32, both  arch_uprobe_analyze_insn() and arch_uprobe_skip_sstep() cast from u8[]  to the similarly-named probe_opcode_t, which is an alias for u32.  Hence there is no endianness conversion warning.Fix this by changing the arch_uprobe::{insn,ixol} fields to __le32 andadding the appropriate __le32_to_cpu() conversions prior to consumingthe instruction encoding. The core uprobes copies these fields as opaqueranges of bytes, and so is unaffected by this change.At the same time, remove MAX_UINSN_BYTES and consistently useAARCH64_INSN_SIZE for clarity.Tested with the following:| #include \u003cstdio.h\u003e| #include \u003cstdbool.h\u003e|| #define noinline __attribute__((noinline))|| static noinline void *adrp_self(void)| {|         void *addr;||         asm volatile(|         \"       adrp    %x0, adrp_self\\n\"|         \"       add     %x0, %x0, :lo12:adrp_self\\n\"|         : \"=r\" (addr));| }||| int main(int argc, char *argv)| {|         void *ptr = adrp_self();|         bool equal = (ptr == adrp_self);||         printf(\"adrp_self   =\u003e %p\\n\"|                \"adrp_self() =\u003e %p\\n\"|                \"%s\\n\",|                adrp_self, ptr, equal ? \"EQUAL\" : \"NOT EQUAL\");||         return 0;| }.... where the adrp_self() function was compiled to:| 00000000004007e0 \u003cadrp_self\u003e:|   4007e0:       90000000        adrp    x0, 400000 \u003c__ehdr_start\u003e|   4007e4:       911f8000        add     x0, x0, #0x7e0|   4007e8:       d65f03c0        retBefore this patch, the ADRP is not recognized, and is assumed to besteppable, resulting in corruption of the result:| # ./adrp-self| adrp_self   =\u003e 0x4007e0| adrp_self() =\u003e 0x4007e0| EQUAL| # echo 'p /root/adrp-self:0x007e0' \u003e /sys/kernel/tracing/uprobe_events| # echo 1 \u003e /sys/kernel/tracing/events/uprobes/enable| # ./adrp-self| adrp_self   =\u003e 0x4007e0| adrp_self() =\u003e 0xffffffffff7e0| NOT EQUALAfter this patch, the ADRP is correctly recognized and simulated:| # ./adrp-self| adrp_self   =\u003e 0x4007e0| adrp_self() =\u003e 0x4007e0| EQUAL| #| # echo 'p /root/adrp-self:0x007e0' \u003e /sys/kernel/tracing/uprobe_events| # echo 1 \u003e /sys/kernel/tracing/events/uprobes/enable| # ./adrp-self| adrp_self   =\u003e 0x4007e0| adrp_self() =\u003e 0x4007e0| EQUAL",
	"type": "none",
	"severity": "medium",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/13f8f1e05f1dc36dbba6cba0ae03354c0dafcde7",
		"https://git.kernel.org/stable/c/14841bb7a531b96e2dde37423a3b33e75147c60d",
		"https://git.kernel.org/stable/c/3d2530c65be04e93720e30f191a7cf1a3aa8b51c",
		"https://git.kernel.org/stable/c/8165bf83b8a64be801d59cd2532b0d1ffed74d00",
		"https://git.kernel.org/stable/c/b6a638cb600e13f94b5464724eaa6ab7f3349ca2",
		"https://git.kernel.org/stable/c/cf60d19d40184e43d9a624e55a0da73be09e938d",
		"https://git.kernel.org/stable/c/cf9ddf9ed94c15564a05bbf6e9f18dffa0c7df80",
		"https://git.kernel.org/stable/c/e6ab336213918575124d6db43dc5d3554526242e"
	],
	"datetime": "2024-12-11 07:24:35",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		},
		{
			"name": "cblmariner",
			"version": "2",
			"vendor": "cblmariner-2"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "\u003c 0:6.1.115-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "any",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux-6.1",
			"version": "\u003c 0:6.1.119-1~deb11u1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux-6.1",
			"version": "\u003c 6.1.119-1~deb11u1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux",
			"version": "\u003c 6.11.5-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		},
		{
			"name": "linux",
			"version": "\u003c 6.1.115-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "kernel",
			"version": "\u003c 0:5.15.173.1-1.",
			"architecture": "any",
			"manager": "apt",
			"vendor": "cblmariner-2"
		}
	],
	"products": [
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 4.19.323",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 5.4.285",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 5.10.229",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 5.15.170",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.1.115",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.6.58",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.11.5",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc1",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc2",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.12-rc3",
			"type": "system"
		}
	],
	"programs": [],
	"weaknesses": [
		{
			"name": "any",
			"impact": "any",
			"scope": "any"
		}
	]
}