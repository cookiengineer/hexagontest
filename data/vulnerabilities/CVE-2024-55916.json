{
	"name": "CVE-2024-55916",
	"description": "In the Linux kernel, the following vulnerability has been resolved:Drivers: hv: util: Avoid accessing a ringbuffer not initialized yetIf the KVP (or VSS) daemon starts before the VMBus channel's ringbuffer isfully initialized, we can hit the panic below:hv_utils: Registering HyperV Utility Driverhv_vmbus: registering driver hv_utils...BUG: kernel NULL pointer dereference, address: 0000000000000000CPU: 44 UID: 0 PID: 2552 Comm: hv_kvp_daemon Tainted: G E 6.11.0-rc3+ #1RIP: 0010:hv_pkt_iter_first+0x12/0xd0Call Trace:... vmbus_recvpacket hv_kvp_onchannelcallback vmbus_on_event tasklet_action_common tasklet_action handle_softirqs irq_exit_rcu sysvec_hyperv_stimer0 \u003c/IRQ\u003e \u003cTASK\u003e asm_sysvec_hyperv_stimer0... kvp_register_done hvt_op_read vfs_read ksys_read __x64_sys_readThis can happen because the KVP/VSS channel callback can be invokedeven before the channel is fully opened:1) as soon as hv_kvp_init() -\u003e hvutil_transport_init() creates/dev/vmbus/hv_kvp, the kvp daemon can open the device file immediately andregister itself to the driver by writing a message KVP_OP_REGISTER1 to thefile (which is handled by kvp_on_msg() -\u003ekvp_handle_handshake()) andreading the file for the driver's response, which is handled byhvt_op_read(), which calls hvt-\u003eon_read(), i.e. kvp_register_done().2) the problem with kvp_register_done() is that it can cause thechannel callback to be called even before the channel is fully opened,and when the channel callback is starting to run, util_probe()-\u003evmbus_open() may have not initialized the ringbuffer yet, so thecallback can hit the panic of NULL pointer dereference.To reproduce the panic consistently, we can add a \"ssleep(10)\" for KVP in__vmbus_open(), just before the first hv_ringbuffer_init(), and then weunload and reload the driver hv_utils, and run the daemon manually withinthe 10 seconds.Fix the panic by reordering the steps in util_probe() so the char deventry used by the KVP or VSS daemon is not created until aftervmbus_open() has completed. This reordering prevents the race conditionfrom happening.",
	"type": "none",
	"severity": "medium",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/042253c57be901bfd19f15b68267442b70f510d5",
		"https://git.kernel.org/stable/c/07a756a49f4b4290b49ea46e089cbe6f79ff8d26",
		"https://git.kernel.org/stable/c/3dd7a30c6d7f90afcf19e9b072f572ba524d7ec6",
		"https://git.kernel.org/stable/c/718fe694a334be9d1a89eed22602369ac18d6583",
		"https://git.kernel.org/stable/c/89fcec5e466b3ac9b376e0d621c71effa1a7983f",
		"https://git.kernel.org/stable/c/d81f4e73aff9b861671df60e5100ad25cc16fbf8",
		"https://git.kernel.org/stable/c/f091a224a2c82f1e302b1768d73bb6332f687321"
	],
	"datetime": "2025-02-06 12:35:28",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		},
		{
			"name": "photonos",
			"version": "4",
			"vendor": "photonos-4"
		},
		{
			"name": "photonos",
			"version": "5",
			"vendor": "photonos-5"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "\u003c 0:6.1.123-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "any",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux",
			"version": "\u003c 6.1.123-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "\u003c 6.12.8-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		},
		{
			"name": "linux",
			"version": "\u003c 5.10.233-1.ph4",
			"architecture": "any",
			"manager": "tdnf",
			"vendor": "photon-4"
		},
		{
			"name": "linux",
			"version": "\u003c 6.1.124-1.ph5",
			"architecture": "any",
			"manager": "tdnf",
			"vendor": "photon-5"
		}
	],
	"products": [
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 5.4.289",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 5.10.233",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 5.15.176",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.1.122",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.6.68",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "\u003c 6.12.7",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.13-rc1",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.13-rc2",
			"type": "system"
		},
		{
			"name": "linux:linux-kernel",
			"vendor": "linux",
			"product": "linux-kernel",
			"version": "6.13-rc3",
			"type": "system"
		}
	],
	"programs": [],
	"weaknesses": [
		{
			"name": "CWE-476",
			"impact": "any",
			"scope": "any"
		}
	]
}