{
	"name": "CVE-2024-50200",
	"description": "In the Linux kernel, the following vulnerability has been resolved:maple_tree: correct tree corruption on spanning storePatch series \"maple_tree: correct tree corruption on spanning store\", v3.There has been a nasty yet subtle maple tree corruption bug that appearsto have been in existence since the inception of the algorithm.This bug seems far more likely to happen since commit f8d112a4e657(\"mm/mmap: avoid zeroing vma tree in mmap_region()\"), which is the pointat which reports started to be submitted concerning this bug.We were made definitely aware of the bug thanks to the kind efforts ofBert Karwatzki who helped enormously in my being able to track this downand identify the cause of it.The bug arises when an attempt is made to perform a spanning store acrosstwo leaf nodes, where the right leaf node is the rightmost child of theshared parent, AND the store completely consumes the right-mode node.This results in mas_wr_spanning_store() mitakenly duplicating the new andexisting entries at the maximum pivot within the range, and thus mapletree corruption.The fix patch corrects this by detecting this scenario and disallowing themistaken duplicate copy.The fix patch commit message goes into great detail as to how this occurs.This series also includes a test which reliably reproduces the issue, andasserts that the fix works correctly.Bert has kindly tested the fix and confirmed it resolved his issues.  AlsoMikhail Gavrilov kindly reported what appears to be precisely the samebug, which this fix should also resolve.This patch (of 2):There has been a subtle bug present in the maple tree implementation fromits inception.This arises from how stores are performed - when a store occurs, it willoverwrite overlapping ranges and adjust the tree as necessary toaccommodate this.A range may always ultimately span two leaf nodes.  In this instance wewalk the two leaf nodes, determine which elements are not overwritten tothe left and to the right of the start and end of the ranges respectivelyand then rebalance the tree to contain these entries and the newlyinserted one.This kind of store is dubbed a 'spanning store' and is implemented bymas_wr_spanning_store().In order to reach this stage, mas_store_gfp() invokesmas_wr_preallocate(), mas_wr_store_type() and mas_wr_walk() in turn towalk the tree and update the object (mas) to traverse to the locationwhere the write should be performed, determining its store type.When a spanning store is required, this function returns false stopping atthe parent node which contains the target range, and mas_wr_store_type()marks the mas-\u003estore_type as wr_spanning_store to denote this fact.When we go to perform the store in mas_wr_spanning_store(), we firstdetermine the elements AFTER the END of the range we wish to store (thatis, to the right of the entry to be inserted) - we do this by walking tothe NEXT pivot in the tree (i.e.  r_mas.last + 1), starting at the node wehave just determined contains the range over which we intend to write.We then turn our attention to the entries to the left of the entry we areinserting, whose state is represented by l_mas, and copy these into a 'bignode', which is a special node which contains enough slots to contain twoleaf node's worth of data.We then copy the entry we wish to store immediately after this - the copyand the insertion of the new entry is performed by mas_store_b_node().After this we copy the elements to the right of the end of the range whichwe are inserting, if we have not exceeded the length of the node (i.e. r_mas.offset \u003c= r_mas.end).Herein lies the bug - under very specific circumstances, this logic canbreak and corrupt the maple tree.Consider the following tree:Height  0                             Root Node                                 /      \\                 pivot = 0xffff /        \\ pivot = ULONG_MAX                               /          ---truncated---",
	"type": "none",
	"severity": "none",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/677f1df179cb68c12ddf7707ec325eb50e99c7d9",
		"https://git.kernel.org/stable/c/7c7874977da9e47ca0f53d8b9a5b17385fed83f2",
		"https://git.kernel.org/stable/c/982dd0d26d1f015ed34866579480d2be5250b0ef",
		"https://git.kernel.org/stable/c/bea07fd63192b61209d48cbb81ef474cc3ee4c62"
	],
	"datetime": "2025-02-06 12:35:23",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "\u003c 0:6.1.115-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux-6.1",
			"version": "\u003c 0:6.1.119-1~deb11u1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux-6.1",
			"version": "\u003c 6.1.119-1~deb11u1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux",
			"version": "\u003c 6.1.115-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "\u003c 5.10.223-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bullseye"
		},
		{
			"name": "linux",
			"version": "\u003c 6.11.5-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		}
	],
	"products": [],
	"programs": [],
	"weaknesses": []
}