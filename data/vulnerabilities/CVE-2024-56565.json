{
	"name": "CVE-2024-56565",
	"description": "In the Linux kernel, the following vulnerability has been resolved:f2fs: fix to drop all discards after creating snapshot on lvm devicePiergiorgio reported a bug in bugzilla as below:------------[ cut here ]------------WARNING: CPU: 2 PID: 969 at fs/f2fs/segment.c:1330RIP: 0010:__submit_discard_cmd+0x27d/0x400 [f2fs]Call Trace: __issue_discard_cmd+0x1ca/0x350 [f2fs] issue_discard_thread+0x191/0x480 [f2fs] kthread+0xcf/0x100 ret_from_fork+0x31/0x50 ret_from_fork_asm+0x1a/0x30w/ below testcase, it can reproduce this bug quickly:- pvcreate /dev/vdb- vgcreate myvg1 /dev/vdb- lvcreate -L 1024m -n mylv1 myvg1- mount /dev/myvg1/mylv1 /mnt/f2fs- dd if=/dev/zero of=/mnt/f2fs/file bs=1M count=20- sync- rm /mnt/f2fs/file- sync- lvcreate -L 1024m -s -n mylv1-snapshot /dev/myvg1/mylv1- umount /mnt/f2fsThe root cause is: it will update discard_max_bytes of mounted lvmdevice to zero after creating snapshot on this lvm device, then,__submit_discard_cmd() will pass parameter @nr_sects w/ zero valueto __blkdev_issue_discard(), it returns a NULL bio pointer, resultin panic.This patch changes as below for fixing:1. Let's drop all remained discards in f2fs_unfreeze() if snapshotof lvm device is created.2. Checking discard_max_bytes before submitting discard during__submit_discard_cmd().",
	"type": "none",
	"severity": "none",
	"state": "published",
	"references": [
		"https://git.kernel.org/stable/c/15136c3861a3341db261ebdbb6ae4ae1765635e2",
		"https://git.kernel.org/stable/c/bc8aeb04fd80cb8cfae3058445c84410fd0beb5e",
		"https://git.kernel.org/stable/c/ed24ab98242f8d22b66fbe0452c97751b5ea4e22"
	],
	"datetime": "2025-02-06 12:35:26",
	"connections": [],
	"devices": [],
	"distributions": [
		{
			"name": "debian",
			"version": "bookworm",
			"vendor": "debian-bookworm"
		},
		{
			"name": "debian",
			"version": "bullseye",
			"vendor": "debian-bullseye"
		},
		{
			"name": "debian",
			"version": "sid",
			"vendor": "debian-sid"
		},
		{
			"name": "debian",
			"version": "trixie",
			"vendor": "debian-trixie"
		}
	],
	"packages": [
		{
			"name": "linux",
			"version": "any",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-bookworm"
		},
		{
			"name": "linux",
			"version": "\u003c 6.12.5-1",
			"architecture": "any",
			"manager": "apt",
			"vendor": "debian-sid"
		}
	],
	"products": [],
	"programs": [],
	"weaknesses": []
}